(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[627],{2415:function(e,t,r){Promise.resolve().then(r.bind(r,6542))},6542:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return VideoChooserPage}});var s,n=r(7437),o=r(5425),i=r(2265),a=r(4033),l=r(4505),c=r(8460),d=r(1684),h=r(1895),x=r(101),u=r(6898),g=r(1300),p=r(2089),m=r(4543);function CompletedJobs(e){let{jobs:t}=e;return t.length?(0,n.jsxs)(c.Z,{sx:{marginTop:6},children:[(0,n.jsx)(d.Z,{variant:"h6",children:"Completed Jobs"}),(0,n.jsx)(g.Z,{children:t.map(e=>{let{jobId:t,filename:r}=e;return(0,n.jsxs)(p.ZP,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,n.jsx)(d.Z,{children:"Video: "+r+"  -  Job ID: "+t}),(0,n.jsx)(m.Z,{href:"http://localhost:3000/process/".concat(r.slice(0,r.length-4),"_").concat(t,".csv"),download:"".concat(r.replace(/\.[^/.]+$/,""),".csv"),sx:{textDecoration:"none"},children:(0,n.jsx)(x.Z,{variant:"outlined",size:"small",children:"Download"})})]},t)})})]}):null}var f=r(3098),j=(s=e=>{let{filename:t,color:r,threshold:s,status:o,error:a,jobId:l,start:h}=e,[g,p]=(0,i.useState)([]);return(0,i.useEffect)(()=>{if(!l)return;let e=setInterval(async()=>{try{let r=await fetch("http://localhost:3000/process/".concat(l,"/status")),s=await r.json();"done"===s.status&&(p(e=>[...e,{jobId:l,filename:t}]),clearInterval(e))}catch(t){console.error("Failed to check job status:",t),clearInterval(e)}},2e3);return()=>clearInterval(e)},[l,t]),(0,n.jsxs)(c.Z,{sx:{marginTop:6,textAlign:"center"},children:[(0,n.jsx)(x.Z,{variant:"contained",onClick:()=>h(t,r,s),disabled:"processing"===o,sx:{backgroundColor:"lightblue",color:"black"},children:"processing"===o?"Processing...":"Start Process"}),"processing"===o&&(0,n.jsx)(c.Z,{sx:{width:"100%",mt:2},children:(0,n.jsx)(u.Z,{})}),a&&(0,n.jsx)(d.Z,{sx:{mt:2,color:"red"},children:a}),"done"===o&&(0,n.jsx)(c.Z,{sx:{mt:2},children:(0,n.jsx)(d.Z,{children:"âœ… Process complete!"})}),(0,n.jsx)(CompletedJobs,{jobs:g})]})},function(e){let[t,r]=(0,i.useState)("idle"),[o,a]=(0,i.useState)(""),[l,c]=(0,i.useState)(null),start=async(e,t,s)=>{a(""),r("processing");try{let r=await fetch("http://localhost:3000/process/".concat(e,"?targetColor=").concat(t.slice(1),"&threshold=").concat(s),{method:"POST",headers:{"Content-Type":"application/json"}});if(!r.ok){let{error:e}=await r.json();throw Error(e)}let n=await r.json();c(n.jobId)}catch(e){a(e.message),r("idle")}};return(0,n.jsxs)(n.Fragment,{children:[o&&(0,n.jsx)(f.Z,{severity:"error",sx:{mb:2},children:o}),(0,n.jsx)(s,{...e,status:t,error:o,jobId:l,start:start})]})});function PreviewVideo(e){let{params:t}=e,{filename:r}=(0,a.useParams)(),[s,o]=(0,i.useState)("#000000"),[x,u]=(0,i.useState)(100),g=(0,i.useRef)(null),p=(0,i.useRef)(null),m="http://localhost:3000/thumbnail/".concat(encodeURIComponent(r));(0,i.useEffect)(()=>{let e=new Image;e.crossOrigin="Anonymous",e.src=m,e.onload=()=>{p.current=e,drawBinarized(e,s,x)}},[m]),(0,i.useEffect)(()=>{p.current&&drawBinarized(p.current,s,x)},[s,x]);let drawBinarized=(e,t,r)=>{let s=g.current,n=s.getContext("2d"),o=300/e.width,i=e.width*o,a=e.height*o;s.width=i,s.height=a,n.drawImage(e,0,0,i,a);let l=n.getImageData(0,0,i,a),c=l.data,d=parseInt(t.slice(1,3),16),h=parseInt(t.slice(3,5),16),x=parseInt(t.slice(5,7),16);for(let e=0;e<c.length;e+=4){let t=c[e],s=c[e+1],n=c[e+2],o=Math.sqrt((t-d)**2+(s-h)**2+(n-x)**2),i=o<r?0:255;c[e]=c[e+1]=c[e+2]=i}n.putImageData(l,0,0)},f={padding:2,borderRadius:2,backgroundColor:"#fff",boxShadow:1,textAlign:"center",maxWidth:320,flex:"1 1 320px"};return(0,n.jsxs)(l.Z,{maxWidth:"md",sx:{py:5,px:3,bgcolor:"#f9f9f9",borderRadius:2,boxShadow:2,marginTop:2},children:[(0,n.jsxs)(c.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:5,marginBottom:2},children:[(0,n.jsxs)(d.Z,{variant:"h4",sx:{fontWeight:600,color:"#1976d2"},children:["Preview: ",r]}),(0,n.jsxs)(c.Z,{sx:{display:"flex",gap:4,flexWrap:"wrap",justifyContent:"center",width:"100%"},children:[(0,n.jsxs)(c.Z,{sx:f,children:[(0,n.jsx)(d.Z,{variant:"h6",gutterBottom:!0,children:"Original"}),(0,n.jsx)("img",{src:m,alt:"Original thumbnail",style:{width:"300px",borderRadius:8,border:"1px solid #ccc"}})]}),(0,n.jsxs)(c.Z,{sx:f,children:[(0,n.jsx)(d.Z,{variant:"h6",gutterBottom:!0,children:"Binarized"}),(0,n.jsx)("canvas",{ref:g,style:{width:"300px",borderRadius:8,border:"1px solid #ccc"}})]})]}),(0,n.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center",flexWrap:"wrap",gap:2,padding:3,borderRadius:2,backgroundColor:"#fff",boxShadow:1,justifyContent:"center"},children:[(0,n.jsx)(d.Z,{children:"Pick Target Color:"}),(0,n.jsx)("input",{type:"color",value:s,onChange:e=>o(e.target.value),style:{width:40,height:40,border:"none",borderRadius:4,cursor:"pointer"}}),(0,n.jsx)(d.Z,{sx:{marginLeft:2},children:"Threshold:"}),(0,n.jsx)(h.ZP,{value:x,min:0,max:255,onChange:(e,t)=>u(t),sx:{width:250}})]})]}),(0,n.jsx)(j,{filename:r,color:s,threshold:x})]})}function VideoChooserPage(){return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(o.Z,{}),(0,n.jsx)(PreviewVideo,{})]})}},5425:function(e,t,r){"use strict";var s=r(7437),n=r(1396),o=r.n(n),i=r(4904),a=r(4505),l=r(3619),c=r(8460),d=r(1684),h=r(101),x=r(9862);t.Z=()=>(0,s.jsx)(i.Z,{position:"static",sx:{bgcolor:"white",boxShadow:1},children:(0,s.jsx)(a.Z,{maxWidth:"lg",children:(0,s.jsxs)(l.Z,{sx:{display:"flex",justifyContent:"space-between"},children:[(0,s.jsx)("a",{href:"/",style:{textDecoration:"none"},children:(0,s.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,s.jsx)(x.Z,{sx:{color:"primary.main",marginRight:1}}),(0,s.jsx)(d.Z,{variant:"h6",component:"div",sx:{color:"primary.main",fontWeight:"bold"},children:"Salamander"})]})}),(0,s.jsxs)(c.Z,{children:[(0,s.jsx)(h.Z,{component:o(),href:"/",sx:{color:"text.primary",mx:1,"&:hover":{bgcolor:"grey.100"}},children:"Home"}),(0,s.jsx)(h.Z,{component:o(),href:"/videos",sx:{color:"text.primary",marginLeft:1,marginRight:1,"&:hover":{bgcolor:"grey.100"}},children:"Videos"})]})]})})})}},function(e){e.O(0,[159,779,345,971,472,744],function(){return e(e.s=2415)}),_N_E=e.O()}]);